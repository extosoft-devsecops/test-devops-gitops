# Global configuration
global:
  clusterName: "gke-nonprod"
  environment: "nonprod"

replicaCount: 1

image:
  repository: asia-southeast1-docker.pkg.dev/test-devops-478606/test-devops-images/test-devops
  tag: "latest"
  pullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 3000
  targetPort: 3000

env:
  serviceName: "test-devops"
  enableMetrics: "true"
  ddDogstatsdPort: "8125"
  nodeEnv: "local"

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

livenessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80

podDisruptionBudget:
  enabled: false
  minAvailable: 1

networkPolicy:
  enabled: false

nodeSelector: {}
tolerations: []
affinity: {}

# Vault configuration for secrets injection
vault:
  enabled: false  # Enable in environment-specific values
  address: "https://vault-devops.extosoft.app"
  skipTLSVerify: "true"
  roleName: "k8s-app"
  serviceAccount: "vault-auth"
  secrets:
    secretPath: ""
    fields:
      appName: "APP_NAME"
      datadogApiKey: "DATA_DOG_API_KEY"
      nodeEnv: "NODE_ENV"

# Datadog Agent Configuration
datadog:
  enabled: false  # Enable in environment-specific values
  apiKey: ""  # Will be sourced from Vault when useVaultSecrets is true
  site: "datadoghq.com"
  useVaultSecrets: false

  agent:
    image:
      repository: datadog/agent
      tag: "latest"
      pullPolicy: Always

    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

    dogstatsd:
      enabled: true
      port: 8125
      useHostPort: false
      nonLocalTraffic: true

    apm:
      enabled: false
      port: 8126

    logs:
      enabled: true
      containerCollectAll: true

    processAgent:
      enabled: true

    networkMonitoring:
      enabled: false

# Datadog Agent Configuration
datadog:
  enabled: true
  apiKey: ""  # Set via --set datadog.apiKey=<YOUR_API_KEY> or use secrets
  site: "datadoghq.com"

  agent:
    image:
      repository: gcr.io/datadoghq/agent
      tag: "7"
      pullPolicy: IfNotPresent

    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

    # DogStatsD configuration
    dogstatsd:
      enabled: true
      port: 8125
      useHostPort: false
      nonLocalTraffic: true

    # APM configuration
    apm:
      enabled: false
      port: 8126

    # Log collection
    logs:
      enabled: true
      containerCollectAll: true

    # Process monitoring
    processAgent:
      enabled: true

    # Network monitoring
    networkMonitoring:
      enabled: false

